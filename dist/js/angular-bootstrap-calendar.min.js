"use strict";angular.module("mwl.calendar",["ui.bootstrap"]),angular.module("mwl.calendar").constant("moment",window.moment),angular.module("mwl.calendar").service("calendarHelper",["$filter","moment",function(e,t){function a(){return 1===t().startOf("week").day()}function n(e){return angular.isDefined(e)?e:a()}var r=this;this.getMonthNames=function(e){for(var a=e?"MMM":"MMMM",n=[],r=0;11>=r;r++)n.push(t(new Date(2014,r)).format(a));return n},this.getWeekDayNames=function(e,a){for(var r=e?"ddd":"dddd",i=[],l=n(a)?22:21,d=0;6>=d;d++)i.push(t(new Date(2014,8,l+d)).format(r));return i},this.eventIsInPeriod=function(e,a,n,r){return t(e).isAfter(t(n))&&t(e).isBefore(t(r))||t(a).isAfter(t(n))&&t(a).isBefore(t(r))||t(e).isBefore(t(n))&&t(a).isAfter(t(r))||t(e).isSame(t(n))||t(a).isSame(t(r))},this.getYearView=function(e,a){for(var n=[],i=r.getMonthNames(),l=0;3>l;l++){for(var d=[],o=0;4>o;o++){var c=12-i.length,s=new Date(t(a).format("YYYY"),c,1),u=t(s).add(1,"month").subtract(1,"second").toDate();d.push({label:i.shift(),monthIndex:c,isToday:t(s).startOf("month").isSame(t().startOf("month")),events:e.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,s,u)})})}n.push(d)}return n},this.getMonthView=function(e,a,i){function l(){var e=o.day()-d;return 0>e&&(e=6),e}for(var d=n(i)?1:0,o=t(a).startOf("month"),c=t(a).endOf("month").date(),s=[],u=new Array(7),f=e.map(function(e,t){return e.$id=t,e}),v=1;c>=v;v++){if(1==v)for(var m=l(o),y=o.clone();m>0;)m--,y=y.subtract(1,"day"),u[m]={label:y.date(),date:y.clone(),inMonth:!1,events:[]};if(u[l(o)]={label:o.date(),inMonth:!0,isToday:t().startOf("day").isSame(o),date:o.clone(),events:f.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,o.clone().startOf("day"),o.clone().endOf("day"))})},v==c)for(var m=l(o),w=o.clone();6>m;)m++,w=w.add(1,"day"),u[m]={label:w.date(),date:w.clone(),inMonth:!1,events:[]};(6===l(o)||v==c)&&(s.push(u),u=new Array(7)),o=o.add(1,"day")}return s},this.getWeekView=function(e,a,i){for(var l,d,o=n(i)?1:0,c=new Array(7),s=r.getWeekDayNames(!1,i),u=a.getDay(),f=u;f>=0;f--){var v=t(a).subtract(u-f,"days").add(o,"day").toDate();c[f]={weekDay:s[f],day:t(v).format("D"),date:t(v).format("D MMM"),isToday:t(v).startOf("day").isSame(t().startOf("day"))},0==f?l=v:6==f&&(d=v)}for(var f=u+1;7>f;f++){var v=t(a).add(f-u,"days").add(o,"day").toDate();c[f]={weekDay:s[f],day:t(v).format("D"),date:t(v).format("D MMM"),isToday:t(v).startOf("day").isSame(t().startOf("day"))},0==f?l=v:6==f&&(d=v)}d=t(d).endOf("day").toDate(),l=t(l).startOf("day").toDate();var m=e.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,l,d)}).map(function(e){var a=t(e.ends_at).startOf("day").diff(t(e.starts_at).startOf("day"),"days")+1;a>=7&&(a=7,t(e.ends_at).startOf("day").diff(t(d).startOf("day"),"days")<0&&(a+=t(e.ends_at).startOf("day").diff(t(d).startOf("day"),"days")+o));var n=t(e.starts_at).startOf("day").diff(t(l).startOf("day"),"days");return 0>n&&(n=0),n>6&&(n=6),a-n>0&&(a-=n),e.daySpan=a,e.dayOffset=n,e});return{columns:c,events:m}},this.getDayView=function(e,a,n,i){var l=t(a).startOf("day").add(n,"hours"),d=t(a).startOf("day").add(i,"hours"),o=60*(i-n+1),c=[];return e.filter(function(e){return r.eventIsInPeriod(e.starts_at,e.ends_at,t(a).startOf("day").toDate(),t(a).endOf("day").toDate())}).map(function(e){if(e.top=t(e.starts_at).isBefore(l)?0:t(e.starts_at).startOf("minute").diff(l.startOf("minute"),"minutes")-2,t(e.ends_at).isAfter(d))e.height=o-e.top;else{var a=e.starts_at;t(e.starts_at).isBefore(l)&&(a=l.toDate()),e.height=t(e.ends_at).diff(a,"minutes")}return e.top-e.height>o&&(e.height=0),e.left=0,e}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return c.forEach(function(a,n){var i=!0;a.forEach(function(t){(r.eventIsInPeriod(e.starts_at,e.ends_at,t.starts_at,t.ends_at)||r.eventIsInPeriod(t.starts_at,t.ends_at,e.starts_at,e.ends_at))&&(i=!1)}),i&&t&&(t=!1,e.left=150*n,c[n].push(e))}),t&&(e.left=150*c.length,c.push([e])),e})},this.toggleEventBreakdown=function(e,t,a){function n(){e=e.map(function(e){return e.isOpened=!1,e.map(function(e){return e.isOpened=!1,e})})}var r=[];if(e[t][a].events.length>0){var i=e[t][a].isOpened;n(),e[t][a].isOpened=!i,e[t].isOpened=!i,r=e[t][a].events}else n();return{view:e,openEvents:r}}}]),angular.module("mwl.calendar").filter("truncateEventTitle",function(){return function(e,t,a){return e?e.length>=t&&e.length/20>a/30?e.substr(0,t)+"...":e:""}}),angular.module("mwl.calendar").directive("mwlCalendarYear",["$sce","$timeout","calendarHelper","moment",function(e,t,a,n){return{templateUrl:"templates/year.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen"},link:function(r,i,l,d){function o(){r.view=a.getYearView(r.events,r.currentDay),r.autoOpen&&!c&&r.view.forEach(function(e,a){e.forEach(function(e,i){e.label==n(r.currentDay).format("MMMM")&&(r.monthClicked(a,i),t(function(){c=!1}))})})}var c=!1;r.$sce=e,d.titleFunctions.year=function(e){return n(e).format("YYYY")},r.$watch("currentDay",o),r.$watch("events",o,!0),r.monthClicked=function(e,t){var n=a.toggleEventBreakdown(r.view,e,t);r.view=n.view,r.openEvents=n.openEvents},r.drillDown=function(e){d.changeView("month",n(r.currentDay).clone().month(e).toDate())}}}}]),angular.module("mwl.calendar").directive("mwlCalendarWeek",["moment","calendarHelper",function(e,t){return{templateUrl:"templates/week.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",useIsoWeek:"=calendarUseIsoWeek",disableDayView:"=disableDayView"},link:function(a,n,r,i){function l(){a.view=t.getWeekView(a.events,a.currentDay,a.useIsoWeek)}i.titleFunctions.week=function(t){return"Week "+e(t).week()+" of "+e(t).format("YYYY")},a.drillDown=function(t){a.disableDayView||i.changeView("day",e(a.currentDay).clone().date(t).toDate())},a.$watch("currentDay",l),a.$watch("events",l,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendarMonth",["$sce","$timeout","$filter","moment","calendarHelper",function(e,t,a,n,r){return{templateUrl:"templates/month.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",disableDayView:"=disableDayView"},link:function(i,l,d,o){function c(){i.view=r.getMonthView(i.events,i.currentDay,i.useIsoWeek),i.autoOpen&&!s&&i.view.forEach(function(e,a){e.forEach(function(e,r){e.inMonth&&n(i.currentDay).startOf("day").isSame(e.date.startOf("day"))&&(i.dayClicked(a,r),t(function(){s=!1}))})})}var s=!1;i.$sce=e,o.titleFunctions.month=function(e){return a("date")(e,"MMMM yyyy")},i.$watch("currentDay",c),i.$watch("events",c,!0),i.weekDays=r.getWeekDayNames(!1,i.useIsoWeek),i.dayClicked=function(e,t){var a=r.toggleEventBreakdown(i.view,e,t);i.view=a.view,i.openEvents=a.openEvents},i.drillDown=function(e){i.disableDayView||o.changeView("day",n(i.currentDay).clone().date(e).toDate())},i.highlightEvent=function(e,t){i.view=i.view.map(function(a){return a.isOpened=!1,a.map(function(a){if(delete a.highlightClass,a.isOpened=!1,t){var n=a.events.filter(function(t){return t.$id==e.$id}).length>0;n&&(a.highlightClass="day-highlight dh-event-"+e.type)}return a})})}}}}]),angular.module("mwl.calendar").directive("mwlCalendarDay",["$filter","moment","calendarHelper",function(e,t,a){return{templateUrl:"templates/day.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd"},link:function(n,r,i,l){function d(){n.view=a.getDayView(n.events,n.currentDay,o.hours(),c.hours())}var o=t(n.dayViewStart||"00:00","HH:mm"),c=t(n.dayViewEnd||"23:00","HH:mm");n.days=[];for(var s=t(o),u=0;u<=c.diff(o,"hours");u++)n.days.push({label:s.format("ha")}),s.add(1,"hour");l.titleFunctions.day=function(t){return e("date")(t,"EEEE d MMMM, yyyy")},n.$watch("currentDay",d),n.$watch("events",d,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",currentDay:"=calendarCurrentDay",control:"=calendarControl",eventClick:"&calendarEventClick",eventEditClick:"&calendarEditEventClick",eventDeleteClick:"&calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd",disableDayView:"=disableDayView"},controller:["$scope","$timeout","$locale","moment",function(e,t,a,n){var r=this;this.titleFunctions={},this.changeView=function(t,a){e.view=t,e.currentDay=a},e.control=e.control||{},e.control.prev=function(){e.currentDay=n(e.currentDay).subtract(1,e.view).toDate()},e.control.next=function(){e.currentDay=n(e.currentDay).add(1,e.view).toDate()},e.control.getTitle=function(){return r.titleFunctions[e.view]?r.titleFunctions[e.view](e.currentDay):""};var i=!0,l=e.$watch(function(){return n.locale()+a.id},function(){if(i)return void(i=!1);var a=angular.copy(e.view);e.view="redraw",t(function(){e.view=a})}),d=e.$on("$destroy",function(){d(),l()})}]}});
//# sourceMappingURL=angular-bootstrap-calendar.min.js.map